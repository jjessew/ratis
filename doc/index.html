<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Ratis</h1>

<p>A Ruby wrapper for Trapeze Group&#39;s ATIS SOAP server.</p>

<p>Goals:</p>

<ul>
<li>Wrap SOAP methods</li>
<li>Provide an ActiveRecord like interface to queries</li>
<li>Return object representations of SOAP responses</li>
<li>Not encapulate any state (other than initial configuration)</li>
<li>Try to catch erroneous queries before making a SOAP request</li>
<li>Handle SOAP errors when they do occur</li>
<li>Handle SOAP method versions changing</li>
</ul>

<p>Presently based on:</p>

<p><strong>ATIS - SOAP Interface Specification Version 2.5.1, February 2012</strong></p>

<p>Currently Supports Ruby <code>1.8.7</code> and <code>1.9.3</code></p>

<h2>Gem installation</h2>

<ol>
<li>Ensure that an SSH identity with permission for the <em>authoritylabs</em> organization on github is available to Bundler.</li>
<li><p>Include the gem in your Gemfile thus:</p>

<pre class="code ruby"><code><span class='rubyid_gem identifier id'>gem</span> <span class='string val'>'ratis'</span><span class='comma token'>,</span> <span class='symbol val'>:git</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'git@github.com:authoritylabs/ratis.git'</span>
</code></pre></li>
<li><p>Add the following configuration block.</p>

<p>This must happen before Ratis is <code>require</code>d (before <code>Rails::Initializer.run</code> in a Rails app).</p>

<pre class="code ruby"><code><span class='rubyid_require identifier id'>require</span> <span class='string val'>'ratis/config'</span>
<span class='rubyid_Ratis constant id'>Ratis</span><span class='dot token'>.</span><span class='rubyid_configure identifier id'>configure</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_config identifier id'>config</span><span class='bitor op'>|</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_endpoint identifier id'>endpoint</span> <span class='assign token'>=</span> <span class='string val'>'http://(YOUR ENDPOINT URL)'</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span> <span class='assign token'>=</span> <span class='string val'>'(YOUR NAMESPACE)'</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_proxy identifier id'>proxy</span> <span class='assign token'>=</span> <span class='string val'>'http://localhost:8080'</span>
  <span class='rubyid_config identifier id'>config</span><span class='dot token'>.</span><span class='rubyid_timeout identifier id'>timeout</span> <span class='assign token'>=</span> <span class='integer val'>5</span>
<span class='rubyid_end end kw'>end</span>
</code></pre>

<p>If Ratis is <code>require</code>d prior to this config being set you will get a <code>RuntimeError</code> informing you so.
 If the provided <code>endpoint</code> is invalid an <code>ArgumentError: Invalid URL: bad URI</code> will be thrown, but only when a request is made.</p></li>
</ol>

<h2>Gem usage</h2>

<h3>Classes</h3>

<p>All the classes are prefixed with <code>Atis</code>, such as:</p>

<pre class="code ruby"><code><span class='rubyid_AtisError constant id'>AtisError</span><span class='comma token'>,</span> <span class='rubyid_AtisItinerary constant id'>AtisItinerary</span><span class='comma token'>,</span> <span class='rubyid_AtisLandmark constant id'>AtisLandmark</span><span class='comma token'>,</span> <span class='rubyid_AtisModel constant id'>AtisModel</span><span class='comma token'>,</span> <span class='rubyid_AtisNextBus constant id'>AtisNextBus</span><span class='comma token'>,</span> <span class='rubyid_AtisRoute constant id'>AtisRoute</span><span class='comma token'>,</span><span class='dot3 op'>...</span>
</code></pre>

<p>All <code>Atis</code> classes, with the exception of <code>AtisModel</code> and <code>AtisError</code> represent data structures returned by SOAP actions.</p>

<p>If you know the SOAP action you want to use, and wish to see if it is implemented in Ratis, you can open a console and ask <code>AtisModel</code> to tell you <code>who_implements_soap_action</code>:</p>

<pre class="code ruby"><code><span class='gt op'>&gt;</span> <span class='rubyid_AtisModel constant id'>AtisModel</span><span class='dot token'>.</span><span class='rubyid_who_implements_soap_action identifier id'>who_implements_soap_action</span> <span class='string val'>'Getlandmarks'</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='rubyid_AtisLandmark constant id'>AtisLandmark</span><span class='rbrack token'>]</span>
</code></pre>

<h3>Queries</h3>

<p>By convention most provide either an <code>all</code> or <code>where</code> class method (following <a href="http://guides.rubyonrails.org/active_record_querying.html#hash-conditions">Active Record&#39;s hash conditions syntax</a>), which will return an array of objects which wrap the response, e.g:</p>

<pre class="code ruby"><code><span class='rshft op'>&gt;&gt;</span> <span class='rubyid_all_landmarks identifier id'>all_landmarks</span> <span class='assign token'>=</span> <span class='rubyid_AtisLandmark constant id'>AtisLandmark</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:all</span>
<span class='rshft op'>&gt;&gt;</span> <span class='rubyid_all_landmarks identifier id'>all_landmarks</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1510</span>
<span class='rshft op'>&gt;&gt;</span> <span class='rubyid_all_landmarks identifier id'>all_landmarks</span><span class='dot token'>.</span><span class='rubyid_first identifier id'>first</span>
<span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;AtisLandmark:0x10d263190 @locality=&quot;N&quot;, @type=&quot;AIRPT&quot;, @location=&quot;4800 E. FALCON DR.&quot;, @verbose=&quot;FALCON FIELD AIRPORT&quot;&gt;</span>
</code></pre>

<h3>Errors</h3>

<p>The <code>where</code> methods will try to sanity check your conditions before making a call to the SOAP server:</p>

<pre class="code ruby"><code><span class='rshft op'>&gt;&gt;</span> <span class='rubyid_AtisLandmark constant id'>AtisLandmark</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
<span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='colon op'>:</span> <span class='rubyid_You constant id'>You</span> <span class='rubyid_must identifier id'>must</span> <span class='rubyid_provide identifier id'>provide</span> <span class='rubyid_a identifier id'>a</span> <span class='rubyid_type identifier id'>type</span>

<span class='rshft op'>&gt;&gt;</span> <span class='rubyid_AtisLandmark constant id'>AtisLandmark</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:foo</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span>
<span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='colon op'>:</span> <span class='rubyid_Conditions constant id'>Conditions</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_used identifier id'>used</span> <span class='rubyid_by identifier id'>by</span> <span class='rubyid_this identifier id'>this</span> <span class='rubyid_class class kw'>class</span><span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='symbol val'>:foo</span><span class='rbrack token'>]</span>
</code></pre>

<p>When something goes wrong with the SOAP transaction an <code>AtisError</code> will be raised:</p>

<pre class="code ruby"><code><span class='rshft op'>&gt;&gt;</span> <span class='rubyid_AtisNextBus constant id'>AtisNextBus</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span> <span class='symbol val'>:stop_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>123456</span>
<span class='comment val'>#&lt;AtisError: #10222--Unknown stop&gt;</span>
</code></pre>

<h2>Development </h2>

<h3>Installation</h3>

<ol>
<li>Clone the repo</li>
<li><code>bundle install</code></li>
</ol>

<h3>Usage</h3>

<ol>
<li><p>For development Ratis is hard coded to use a local proxy server on port 8080:</p>

<pre class="code ruby"><code><span class='rubyid_ssh identifier id'>ssh</span> <span class='minus op'>-</span><span class='rubyid_i identifier id'>i</span> <span class='bitnot op'>~</span><span class='regexp val'>/.ssh/</span><span class='rubyid_authoritylabs identifier id'>authoritylabs</span><span class='dot token'>.</span><span class='rubyid_pem identifier id'>pem</span> <span class='minus op'>-</span><span class='rubyid_L constant id'>L</span> <span class='integer val'>8080</span><span class='symbol val'>:localhost</span><span class='symbol val'>:3128</span> <span class='rubyid_ubuntu identifier id'>ubuntu</span><span class='rubyid_@codingsanctum ivar id'>@codingsanctum</span><span class='dot token'>.</span><span class='rubyid_com identifier id'>com</span>
</code></pre></li>
<li><p>Run the test suite with <code>rake</code></p></li>
<li><p>Test it out with <code>irb -I lib/ -r rubygems -r ratis</code></p></li>
<li><p>After terminal is open with above step, paste in your application&#39;s connection config settings. Example:</p></li>
</ol>

<p>Ratis.configure do |config|
    config.endpoint = &#39;http://(YOUR ENDPOINT URL)&#39;
    config.namespace = &#39;(YOUR NAMESPACE)&#39;
    config.timeout = 5
  end</p>

<h3>Extending</h3>

<p>The <code>AtisLandmark</code> class is a simple one to look at for reference, and will be referred to below:</p>

<h4>Testing</h4>

<p>You can see the spec for it in <code>spec/ratis/atis_landmark_spec.rb</code>, it uses helper methods defined in <code>spec/spec_helper.rb</code>:</p>

<ol>
<li><p><code>stub_atis_request</code> tells <code>Webmock</code> to stub a <code>POST</code> to the ATIS SOAP server, any request which hasn&#39;t been explicitly allowed will trigger an exception.</p></li>
<li><p><code>atis_response</code> returns a string of the form returned in the body of a response from the ATIS SOAP server. It takes the SOAP action and version the response appears to be for, and a method specific response code and body.</p></li>
</ol>

<p>Because the method specific response bodies are quite long, it is convenient to wrap them in a heredoc, thus:</p>

<pre class="code ruby"><code>     <span class='rubyid_atis_response identifier id'>atis_response</span> <span class='string val'>'Getlandmarks'</span><span class='comma token'>,</span> <span class='string val'>'1.4'</span><span class='comma token'>,</span> <span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>&quot;&lt;Landmarks&gt;\n[snip]\n&lt;/Landmarks&gt;\n&quot;</span>
</code></pre>

<ol>
<li><p><code>an_atis_request</code> returns a <code>Webmock</code> <code>a_request</code> object for a <code>POST</code> to the ATIS SOAP, which can be used like this:</p>

<pre class="code ruby"><code><span class='rubyid_an_atis_request identifier id'>an_atis_request</span><span class='dot token'>.</span><span class='rubyid_should identifier id'>should</span> <span class='rubyid_have_been_made identifier id'>have_been_made</span><span class='dot token'>.</span><span class='rubyid_times identifier id'>times</span> <span class='integer val'>1</span>
</code></pre></li>
<li><p><code>an_atis_request_for</code> is an <code>a_request</code> object for a specific SOAP action with specific parameters passed, which can be used like this:</p>

<pre class="code ruby"><code><span class='rubyid_an_atis_request_for identifier id'>an_atis_request_for</span><span class='lparen token'>(</span><span class='string val'>'Getlandmarks'</span><span class='comma token'>,</span> <span class='string val'>'Type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ALL'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_should identifier id'>should</span> <span class='rubyid_have_been_made identifier id'>have_been_made</span>
</code></pre></li>
</ol>

<h4>Implementing</h4>

<p>To ease interaction with the ATIS SOAP server the <code>AtisModel</code> module is available. Any class which makes requests to the server should:</p>

<pre class="code ruby"><code><span class='rubyid_require identifier id'>require</span> <span class='string val'>'ratis/atis_model'</span>
<span class='rubyid_extend identifier id'>extend</span> <span class='rubyid_AtisModel constant id'>AtisModel</span>
</code></pre>

<p>You get the following:</p>

<ol>
<li><p><code>atis_request</code> should be used to make request to the ATIS SOAP server. It ensures the request is built in a way which the ATIS SOAP server expects, provides a version check against responses and returns a <code>Savon::Response</code>:</p>

<pre class="code ruby"><code><span class='rubyid_atis_request identifier id'>atis_request</span> <span class='string val'>'Getlandmarks'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'Type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_type identifier id'>type</span><span class='rbrace token'>}</span>
</code></pre></li>
</ol>

<p>The method and parameter names should be given as described by the ATIS SOAP Interface reference, with the first character uppercase and all others lowercase.</p>

<p>Now when a request for <code>Getlandmarks</code> is made the response&#39;s method version will be checked, and an <code>AtisError</code> will be thrown if it has not been declared. This ensures that a change on the SOAP server will not result in invalid response parsing by Ratis.</p>

<ol>
<li><code>all_conditions_used?</code> will raise an <code>ArgumentError</code> if the given hash is not empty. </li>
</ol>

<p>Convention in Ratis is to provide a <code>self.where(conditions)</code> method (following <a href="http://guides.rubyonrails.org/active_record_querying.html#hash-conditions">Active Record&#39;s hash conditions syntax</a>). As each key in <code>conditions</code> is used it can be  <code>delete</code>d from <code>conditions</code>, then <code>all_conditions_used? conditions</code> can be called to ensure nothing unimplemented was passed to <code>where</code>.</p>

<p>It is also wise to raise an <code>ArgumentError</code> if an argument which is required isn&#39;t present in <code>conditions</code>.</p>

<p>Putting these steps together you get the following pattern:</p>

<pre class="code ruby"><code>    <span class='rubyid_type identifier id'>type</span> <span class='assign token'>=</span> <span class='rubyid_conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:type</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='rubyid_upcase identifier id'>upcase</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'You must provide a type'</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_blank? fid id'>blank?</span>
    <span class='rubyid_all_conditions_used? fid id'>all_conditions_used?</span> <span class='rubyid_conditions identifier id'>conditions</span>
</code></pre>

<p>Following this pattern will provide a good deal of safety for someone using <code>where</code>, and eliminate potentially confusing SOAP errors.</p>

<ol>
<li><code>valid_latitude?</code> and <code>valid_longitude?</code> do range checks.</li>
</ol>
</div></div>

    <div id="footer">
  Generated on Wed Jan 16 16:46:42 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.8.7).
</div>

  </body>
</html>